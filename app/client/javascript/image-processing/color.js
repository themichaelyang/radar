"use strict";

// function

// probably incorrect
function colorNormalize(data) {
    for (var i = 0; i < data.length; i += 4) {
        var r = data[i];
        var g = data[i + 1];
        var b = data[i + 2];
        // let a = data[i+3];

        var colorSum = r + g + b;
        var rNormalized = r / colorSum;
        var gNormalized = g / colorSum;
        var bNormalized = b / colorSum;

        data[i] = rNormalized * 2 * 255;
        data[i + 1] = gNormalized * 2 * 255;
        data[i + 2] = bNormalized * 2 * 255;
        data[i + 3] = 255;
    }
}

// https://en.wikipedia.org/wiki/Color_normalization
// grey world algorithm
// not sure if real grey world tbh
function greyWorldNormalize(data) {
    var rSum = 0;
    var gSum = 0;
    var bSum = 0;
    // let ySum = 0;
    var n = data.length / 4;
    for (var i = 0; i < data.length; i += 4) {
        var r = data[i];
        var g = data[i + 1];
        var b = data[i + 2];
        // let a = data[i+3];

        rSum += r;
        gSum += g;
        bSum += b;
        // let y = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
        // ySum += y;
    }
    var avg = (rSum + gSum + bSum) / data.length;
    // luminance calculation
    // from http://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color
    var ySum = (0.299 * rSum + 0.587 * gSum + 0.114 * bSum) / 255;
    var yAvg = ySum / n;
    console.log(yAvg);
    for (var _i = 0; _i < data.length; _i += 4) {
        var _r = data[_i];
        var _g = data[_i + 1];
        var _b = data[_i + 2];
        // let a = data[i+3];

        // use luminance roughly
        // technically should recalculate rgb based on avg luminance
        data[_i] = _r * n / rSum * yAvg * 255;
        data[_i + 1] = _g * n / gSum * yAvg * 255;
        data[_i + 2] = _b * n / bSum * yAvg * 255;
        // mean value is (1, 1, 1)
        // data[i] = ((r * n) / (rSum * 2)) * 255;
        // data[i+1] = ((g * n) / (gSum * 2)) * 255;
        // data[i+2] = ((b * n) / (bSum * 2)) * 255;
        data[_i + 3] = 255;
        // if (90 < i && i < 100) {
        //   console.log(((r * n) / rSum));
        // }
    }
}

// to hsv
// algorithm from http://www.niwa.nu/2013/05/math-behind-colorspace-conversions-rgb-hsl/
// http://math.stackexchange.com/questions/556341/rgb-to-hsv-color-conversion-algorithm

function hsvNormalize(data) {
    for (var i = 0; i < data.length; i += 4) {
        var r = data[i];
        var g = data[i + 1];
        var b = data[i + 2];
        // let a = data[i+3];

        var hsv = RGBtoHSV(r, g, b);
        hsv.v = 0.8;
        var rgb = HSVtoRGB(hsv);

        data[i] = rgb.r;
        data[i + 1] = rgb.g;
        data[i + 2] = rgb.b;
        data[i + 3] = 255;
    }
}

// hsv functions from
// http://stackoverflow.com/questions/17242144/javascript-convert-hsb-hsv-color-to-rgb-accurately
function HSVtoRGB(h, s, v) {
    var r, g, b, i, f, p, q, t;
    if (arguments.length === 1) {
        s = h.s, v = h.v, h = h.h;
    }
    i = Math.floor(h * 6);
    f = h * 6 - i;
    p = v * (1 - s);
    q = v * (1 - f * s);
    t = v * (1 - (1 - f) * s);
    switch (i % 6) {
        case 0:
            r = v, g = t, b = p;break;
        case 1:
            r = q, g = v, b = p;break;
        case 2:
            r = p, g = v, b = t;break;
        case 3:
            r = p, g = q, b = v;break;
        case 4:
            r = t, g = p, b = v;break;
        case 5:
            r = v, g = p, b = q;break;
    }
    return {
        r: Math.round(r * 255),
        g: Math.round(g * 255),
        b: Math.round(b * 255)
    };
}

function RGBtoHSV(r, g, b) {
    if (arguments.length === 1) {
        g = r.g, b = r.b, r = r.r;
    }
    var max = Math.max(r, g, b),
        min = Math.min(r, g, b),
        d = max - min,
        h,
        s = max === 0 ? 0 : d / max,
        v = max / 255;

    switch (max) {
        case min:
            h = 0;break;
        case r:
            h = g - b + d * (g < b ? 6 : 0);h /= 6 * d;break;
        case g:
            h = b - r + d * 2;h /= 6 * d;break;
        case b:
            h = r - g + d * 4;h /= 6 * d;break;
    }

    return {
        h: h,
        s: s,
        v: v
    };
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImphdmFzY3JpcHQvaW1hZ2UtcHJvY2Vzc2luZy9jb2xvci5qcyJdLCJuYW1lcyI6WyJjb2xvck5vcm1hbGl6ZSIsImRhdGEiLCJpIiwibGVuZ3RoIiwiciIsImciLCJiIiwiY29sb3JTdW0iLCJyTm9ybWFsaXplZCIsImdOb3JtYWxpemVkIiwiYk5vcm1hbGl6ZWQiLCJncmV5V29ybGROb3JtYWxpemUiLCJyU3VtIiwiZ1N1bSIsImJTdW0iLCJuIiwiYXZnIiwieVN1bSIsInlBdmciLCJjb25zb2xlIiwibG9nIiwiaHN2Tm9ybWFsaXplIiwiaHN2IiwiUkdCdG9IU1YiLCJ2IiwicmdiIiwiSFNWdG9SR0IiLCJoIiwicyIsImYiLCJwIiwicSIsInQiLCJhcmd1bWVudHMiLCJNYXRoIiwiZmxvb3IiLCJyb3VuZCIsIm1heCIsIm1pbiIsImQiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBRUE7QUFDQSxTQUFTQSxjQUFULENBQXdCQyxJQUF4QixFQUE4QjtBQUM1QixTQUFLLElBQUlDLElBQUksQ0FBYixFQUFnQkEsSUFBSUQsS0FBS0UsTUFBekIsRUFBaUNELEtBQUssQ0FBdEMsRUFBeUM7QUFDdkMsWUFBSUUsSUFBSUgsS0FBS0MsQ0FBTCxDQUFSO0FBQ0EsWUFBSUcsSUFBSUosS0FBS0MsSUFBRSxDQUFQLENBQVI7QUFDQSxZQUFJSSxJQUFJTCxLQUFLQyxJQUFFLENBQVAsQ0FBUjtBQUNBOztBQUVBLFlBQUlLLFdBQVdILElBQUlDLENBQUosR0FBUUMsQ0FBdkI7QUFDQSxZQUFJRSxjQUFjSixJQUFJRyxRQUF0QjtBQUNBLFlBQUlFLGNBQWNKLElBQUlFLFFBQXRCO0FBQ0EsWUFBSUcsY0FBY0osSUFBSUMsUUFBdEI7O0FBRUFOLGFBQUtDLENBQUwsSUFBVU0sY0FBYyxDQUFkLEdBQWtCLEdBQTVCO0FBQ0FQLGFBQUtDLElBQUUsQ0FBUCxJQUFZTyxjQUFjLENBQWQsR0FBa0IsR0FBOUI7QUFDQVIsYUFBS0MsSUFBRSxDQUFQLElBQVlRLGNBQWMsQ0FBZCxHQUFrQixHQUE5QjtBQUNBVCxhQUFLQyxJQUFFLENBQVAsSUFBWSxHQUFaO0FBQ0Q7QUFDRjs7QUFFRDtBQUNBO0FBQ0E7QUFDQSxTQUFTUyxrQkFBVCxDQUE0QlYsSUFBNUIsRUFBa0M7QUFDaEMsUUFBSVcsT0FBTyxDQUFYO0FBQ0EsUUFBSUMsT0FBTyxDQUFYO0FBQ0EsUUFBSUMsT0FBTyxDQUFYO0FBQ0E7QUFDQSxRQUFJQyxJQUFJZCxLQUFLRSxNQUFMLEdBQWMsQ0FBdEI7QUFDQSxTQUFLLElBQUlELElBQUksQ0FBYixFQUFnQkEsSUFBSUQsS0FBS0UsTUFBekIsRUFBaUNELEtBQUssQ0FBdEMsRUFBeUM7QUFDdkMsWUFBSUUsSUFBSUgsS0FBS0MsQ0FBTCxDQUFSO0FBQ0EsWUFBSUcsSUFBSUosS0FBS0MsSUFBRSxDQUFQLENBQVI7QUFDQSxZQUFJSSxJQUFJTCxLQUFLQyxJQUFFLENBQVAsQ0FBUjtBQUNBOztBQUVBVSxnQkFBUVIsQ0FBUjtBQUNBUyxnQkFBUVIsQ0FBUjtBQUNBUyxnQkFBUVIsQ0FBUjtBQUNBO0FBQ0E7QUFDRDtBQUNELFFBQUlVLE1BQU0sQ0FBQ0osT0FBT0MsSUFBUCxHQUFjQyxJQUFmLElBQXVCYixLQUFLRSxNQUF0QztBQUNBO0FBQ0E7QUFDQSxRQUFJYyxPQUFPLENBQUMsUUFBUUwsSUFBUixHQUFlLFFBQVFDLElBQXZCLEdBQThCLFFBQVFDLElBQXZDLElBQStDLEdBQTFEO0FBQ0EsUUFBSUksT0FBT0QsT0FBT0YsQ0FBbEI7QUFDQUksWUFBUUMsR0FBUixDQUFZRixJQUFaO0FBQ0EsU0FBSyxJQUFJaEIsS0FBSSxDQUFiLEVBQWdCQSxLQUFJRCxLQUFLRSxNQUF6QixFQUFpQ0QsTUFBSyxDQUF0QyxFQUF5QztBQUN2QyxZQUFJRSxLQUFJSCxLQUFLQyxFQUFMLENBQVI7QUFDQSxZQUFJRyxLQUFJSixLQUFLQyxLQUFFLENBQVAsQ0FBUjtBQUNBLFlBQUlJLEtBQUlMLEtBQUtDLEtBQUUsQ0FBUCxDQUFSO0FBQ0E7O0FBRUE7QUFDQTtBQUNBRCxhQUFLQyxFQUFMLElBQVlFLEtBQUlXLENBQUwsR0FBVUgsSUFBWCxHQUFtQk0sSUFBbkIsR0FBMEIsR0FBcEM7QUFDQWpCLGFBQUtDLEtBQUUsQ0FBUCxJQUFjRyxLQUFJVSxDQUFMLEdBQVVGLElBQVgsR0FBbUJLLElBQW5CLEdBQTBCLEdBQXRDO0FBQ0FqQixhQUFLQyxLQUFFLENBQVAsSUFBY0ksS0FBSVMsQ0FBTCxHQUFVRCxJQUFYLEdBQW1CSSxJQUFuQixHQUEwQixHQUF0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0FqQixhQUFLQyxLQUFFLENBQVAsSUFBWSxHQUFaO0FBQ0E7QUFDQTtBQUNBO0FBQ0Q7QUFDRjs7QUFHRDtBQUNBO0FBQ0E7O0FBRUEsU0FBU21CLFlBQVQsQ0FBc0JwQixJQUF0QixFQUE0QjtBQUMxQixTQUFLLElBQUlDLElBQUksQ0FBYixFQUFnQkEsSUFBSUQsS0FBS0UsTUFBekIsRUFBaUNELEtBQUssQ0FBdEMsRUFBeUM7QUFDdkMsWUFBSUUsSUFBSUgsS0FBS0MsQ0FBTCxDQUFSO0FBQ0EsWUFBSUcsSUFBSUosS0FBS0MsSUFBRSxDQUFQLENBQVI7QUFDQSxZQUFJSSxJQUFJTCxLQUFLQyxJQUFFLENBQVAsQ0FBUjtBQUNBOztBQUVBLFlBQUlvQixNQUFNQyxTQUFTbkIsQ0FBVCxFQUFZQyxDQUFaLEVBQWVDLENBQWYsQ0FBVjtBQUNBZ0IsWUFBSUUsQ0FBSixHQUFRLEdBQVI7QUFDQSxZQUFJQyxNQUFNQyxTQUFTSixHQUFULENBQVY7O0FBRUFyQixhQUFLQyxDQUFMLElBQVV1QixJQUFJckIsQ0FBZDtBQUNBSCxhQUFLQyxJQUFFLENBQVAsSUFBWXVCLElBQUlwQixDQUFoQjtBQUNBSixhQUFLQyxJQUFFLENBQVAsSUFBWXVCLElBQUluQixDQUFoQjtBQUNBTCxhQUFLQyxJQUFFLENBQVAsSUFBWSxHQUFaO0FBQ0Q7QUFDRjs7QUFFRDtBQUNBO0FBQ0EsU0FBU3dCLFFBQVQsQ0FBa0JDLENBQWxCLEVBQXFCQyxDQUFyQixFQUF3QkosQ0FBeEIsRUFBMkI7QUFDdkIsUUFBSXBCLENBQUosRUFBT0MsQ0FBUCxFQUFVQyxDQUFWLEVBQWFKLENBQWIsRUFBZ0IyQixDQUFoQixFQUFtQkMsQ0FBbkIsRUFBc0JDLENBQXRCLEVBQXlCQyxDQUF6QjtBQUNBLFFBQUlDLFVBQVU5QixNQUFWLEtBQXFCLENBQXpCLEVBQTRCO0FBQ3hCeUIsWUFBSUQsRUFBRUMsQ0FBTixFQUFTSixJQUFJRyxFQUFFSCxDQUFmLEVBQWtCRyxJQUFJQSxFQUFFQSxDQUF4QjtBQUNIO0FBQ0R6QixRQUFJZ0MsS0FBS0MsS0FBTCxDQUFXUixJQUFJLENBQWYsQ0FBSjtBQUNBRSxRQUFJRixJQUFJLENBQUosR0FBUXpCLENBQVo7QUFDQTRCLFFBQUlOLEtBQUssSUFBSUksQ0FBVCxDQUFKO0FBQ0FHLFFBQUlQLEtBQUssSUFBSUssSUFBSUQsQ0FBYixDQUFKO0FBQ0FJLFFBQUlSLEtBQUssSUFBSSxDQUFDLElBQUlLLENBQUwsSUFBVUQsQ0FBbkIsQ0FBSjtBQUNBLFlBQVExQixJQUFJLENBQVo7QUFDSSxhQUFLLENBQUw7QUFBUUUsZ0JBQUlvQixDQUFKLEVBQU9uQixJQUFJMkIsQ0FBWCxFQUFjMUIsSUFBSXdCLENBQWxCLENBQXFCO0FBQzdCLGFBQUssQ0FBTDtBQUFRMUIsZ0JBQUkyQixDQUFKLEVBQU8xQixJQUFJbUIsQ0FBWCxFQUFjbEIsSUFBSXdCLENBQWxCLENBQXFCO0FBQzdCLGFBQUssQ0FBTDtBQUFRMUIsZ0JBQUkwQixDQUFKLEVBQU96QixJQUFJbUIsQ0FBWCxFQUFjbEIsSUFBSTBCLENBQWxCLENBQXFCO0FBQzdCLGFBQUssQ0FBTDtBQUFRNUIsZ0JBQUkwQixDQUFKLEVBQU96QixJQUFJMEIsQ0FBWCxFQUFjekIsSUFBSWtCLENBQWxCLENBQXFCO0FBQzdCLGFBQUssQ0FBTDtBQUFRcEIsZ0JBQUk0QixDQUFKLEVBQU8zQixJQUFJeUIsQ0FBWCxFQUFjeEIsSUFBSWtCLENBQWxCLENBQXFCO0FBQzdCLGFBQUssQ0FBTDtBQUFRcEIsZ0JBQUlvQixDQUFKLEVBQU9uQixJQUFJeUIsQ0FBWCxFQUFjeEIsSUFBSXlCLENBQWxCLENBQXFCO0FBTmpDO0FBUUEsV0FBTztBQUNIM0IsV0FBRzhCLEtBQUtFLEtBQUwsQ0FBV2hDLElBQUksR0FBZixDQURBO0FBRUhDLFdBQUc2QixLQUFLRSxLQUFMLENBQVcvQixJQUFJLEdBQWYsQ0FGQTtBQUdIQyxXQUFHNEIsS0FBS0UsS0FBTCxDQUFXOUIsSUFBSSxHQUFmO0FBSEEsS0FBUDtBQUtIOztBQUVELFNBQVNpQixRQUFULENBQWtCbkIsQ0FBbEIsRUFBcUJDLENBQXJCLEVBQXdCQyxDQUF4QixFQUEyQjtBQUN2QixRQUFJMkIsVUFBVTlCLE1BQVYsS0FBcUIsQ0FBekIsRUFBNEI7QUFDeEJFLFlBQUlELEVBQUVDLENBQU4sRUFBU0MsSUFBSUYsRUFBRUUsQ0FBZixFQUFrQkYsSUFBSUEsRUFBRUEsQ0FBeEI7QUFDSDtBQUNELFFBQUlpQyxNQUFNSCxLQUFLRyxHQUFMLENBQVNqQyxDQUFULEVBQVlDLENBQVosRUFBZUMsQ0FBZixDQUFWO0FBQUEsUUFBNkJnQyxNQUFNSixLQUFLSSxHQUFMLENBQVNsQyxDQUFULEVBQVlDLENBQVosRUFBZUMsQ0FBZixDQUFuQztBQUFBLFFBQ0lpQyxJQUFJRixNQUFNQyxHQURkO0FBQUEsUUFFSVgsQ0FGSjtBQUFBLFFBR0lDLElBQUtTLFFBQVEsQ0FBUixHQUFZLENBQVosR0FBZ0JFLElBQUlGLEdBSDdCO0FBQUEsUUFJSWIsSUFBSWEsTUFBTSxHQUpkOztBQU1BLFlBQVFBLEdBQVI7QUFDSSxhQUFLQyxHQUFMO0FBQVVYLGdCQUFJLENBQUosQ0FBTztBQUNqQixhQUFLdkIsQ0FBTDtBQUFRdUIsZ0JBQUt0QixJQUFJQyxDQUFMLEdBQVVpQyxLQUFLbEMsSUFBSUMsQ0FBSixHQUFRLENBQVIsR0FBVyxDQUFoQixDQUFkLENBQWtDcUIsS0FBSyxJQUFJWSxDQUFULENBQVk7QUFDdEQsYUFBS2xDLENBQUw7QUFBUXNCLGdCQUFLckIsSUFBSUYsQ0FBTCxHQUFVbUMsSUFBSSxDQUFsQixDQUFxQlosS0FBSyxJQUFJWSxDQUFULENBQVk7QUFDekMsYUFBS2pDLENBQUw7QUFBUXFCLGdCQUFLdkIsSUFBSUMsQ0FBTCxHQUFVa0MsSUFBSSxDQUFsQixDQUFxQlosS0FBSyxJQUFJWSxDQUFULENBQVk7QUFKN0M7O0FBT0EsV0FBTztBQUNIWixXQUFHQSxDQURBO0FBRUhDLFdBQUdBLENBRkE7QUFHSEosV0FBR0E7QUFIQSxLQUFQO0FBS0giLCJmaWxlIjoiamF2YXNjcmlwdC9pbWFnZS1wcm9jZXNzaW5nL2NvbG9yLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gZnVuY3Rpb25cblxuLy8gcHJvYmFibHkgaW5jb3JyZWN0XG5mdW5jdGlvbiBjb2xvck5vcm1hbGl6ZShkYXRhKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gNCkge1xuICAgIGxldCByID0gZGF0YVtpXTtcbiAgICBsZXQgZyA9IGRhdGFbaSsxXTtcbiAgICBsZXQgYiA9IGRhdGFbaSsyXTtcbiAgICAvLyBsZXQgYSA9IGRhdGFbaSszXTtcblxuICAgIGxldCBjb2xvclN1bSA9IHIgKyBnICsgYjtcbiAgICBsZXQgck5vcm1hbGl6ZWQgPSByIC8gY29sb3JTdW07XG4gICAgbGV0IGdOb3JtYWxpemVkID0gZyAvIGNvbG9yU3VtO1xuICAgIGxldCBiTm9ybWFsaXplZCA9IGIgLyBjb2xvclN1bTtcblxuICAgIGRhdGFbaV0gPSByTm9ybWFsaXplZCAqIDIgKiAyNTU7XG4gICAgZGF0YVtpKzFdID0gZ05vcm1hbGl6ZWQgKiAyICogMjU1O1xuICAgIGRhdGFbaSsyXSA9IGJOb3JtYWxpemVkICogMiAqIDI1NTtcbiAgICBkYXRhW2krM10gPSAyNTU7XG4gIH1cbn1cblxuLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29sb3Jfbm9ybWFsaXphdGlvblxuLy8gZ3JleSB3b3JsZCBhbGdvcml0aG1cbi8vIG5vdCBzdXJlIGlmIHJlYWwgZ3JleSB3b3JsZCB0YmhcbmZ1bmN0aW9uIGdyZXlXb3JsZE5vcm1hbGl6ZShkYXRhKSB7XG4gIGxldCByU3VtID0gMDtcbiAgbGV0IGdTdW0gPSAwO1xuICBsZXQgYlN1bSA9IDA7XG4gIC8vIGxldCB5U3VtID0gMDtcbiAgbGV0IG4gPSBkYXRhLmxlbmd0aCAvIDQ7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gNCkge1xuICAgIGxldCByID0gZGF0YVtpXTtcbiAgICBsZXQgZyA9IGRhdGFbaSsxXTtcbiAgICBsZXQgYiA9IGRhdGFbaSsyXTtcbiAgICAvLyBsZXQgYSA9IGRhdGFbaSszXTtcblxuICAgIHJTdW0gKz0gcjtcbiAgICBnU3VtICs9IGc7XG4gICAgYlN1bSArPSBiO1xuICAgIC8vIGxldCB5ID0gKDAuMjk5ICogciArIDAuNTg3ICogZyArIDAuMTE0ICogYikgLyAyNTU7XG4gICAgLy8geVN1bSArPSB5O1xuICB9XG4gIGxldCBhdmcgPSAoclN1bSArIGdTdW0gKyBiU3VtKSAvIGRhdGEubGVuZ3RoO1xuICAvLyBsdW1pbmFuY2UgY2FsY3VsYXRpb25cbiAgLy8gZnJvbSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzU5NjIxNi9mb3JtdWxhLXRvLWRldGVybWluZS1icmlnaHRuZXNzLW9mLXJnYi1jb2xvclxuICBsZXQgeVN1bSA9ICgwLjI5OSAqIHJTdW0gKyAwLjU4NyAqIGdTdW0gKyAwLjExNCAqIGJTdW0pIC8gMjU1O1xuICBsZXQgeUF2ZyA9IHlTdW0gLyBuO1xuICBjb25zb2xlLmxvZyh5QXZnKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgbGV0IHIgPSBkYXRhW2ldO1xuICAgIGxldCBnID0gZGF0YVtpKzFdO1xuICAgIGxldCBiID0gZGF0YVtpKzJdO1xuICAgIC8vIGxldCBhID0gZGF0YVtpKzNdO1xuXG4gICAgLy8gdXNlIGx1bWluYW5jZSByb3VnaGx5XG4gICAgLy8gdGVjaG5pY2FsbHkgc2hvdWxkIHJlY2FsY3VsYXRlIHJnYiBiYXNlZCBvbiBhdmcgbHVtaW5hbmNlXG4gICAgZGF0YVtpXSA9ICgociAqIG4pIC8gclN1bSkgKiB5QXZnICogMjU1O1xuICAgIGRhdGFbaSsxXSA9ICgoZyAqIG4pIC8gZ1N1bSkgKiB5QXZnICogMjU1O1xuICAgIGRhdGFbaSsyXSA9ICgoYiAqIG4pIC8gYlN1bSkgKiB5QXZnICogMjU1O1xuICAgIC8vIG1lYW4gdmFsdWUgaXMgKDEsIDEsIDEpXG4gICAgLy8gZGF0YVtpXSA9ICgociAqIG4pIC8gKHJTdW0gKiAyKSkgKiAyNTU7XG4gICAgLy8gZGF0YVtpKzFdID0gKChnICogbikgLyAoZ1N1bSAqIDIpKSAqIDI1NTtcbiAgICAvLyBkYXRhW2krMl0gPSAoKGIgKiBuKSAvIChiU3VtICogMikpICogMjU1O1xuICAgIGRhdGFbaSszXSA9IDI1NTtcbiAgICAvLyBpZiAoOTAgPCBpICYmIGkgPCAxMDApIHtcbiAgICAvLyAgIGNvbnNvbGUubG9nKCgociAqIG4pIC8gclN1bSkpO1xuICAgIC8vIH1cbiAgfVxufVxuXG5cbi8vIHRvIGhzdlxuLy8gYWxnb3JpdGhtIGZyb20gaHR0cDovL3d3dy5uaXdhLm51LzIwMTMvMDUvbWF0aC1iZWhpbmQtY29sb3JzcGFjZS1jb252ZXJzaW9ucy1yZ2ItaHNsL1xuLy8gaHR0cDovL21hdGguc3RhY2tleGNoYW5nZS5jb20vcXVlc3Rpb25zLzU1NjM0MS9yZ2ItdG8taHN2LWNvbG9yLWNvbnZlcnNpb24tYWxnb3JpdGhtXG5cbmZ1bmN0aW9uIGhzdk5vcm1hbGl6ZShkYXRhKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gNCkge1xuICAgIGxldCByID0gZGF0YVtpXTtcbiAgICBsZXQgZyA9IGRhdGFbaSsxXTtcbiAgICBsZXQgYiA9IGRhdGFbaSsyXTtcbiAgICAvLyBsZXQgYSA9IGRhdGFbaSszXTtcblxuICAgIGxldCBoc3YgPSBSR0J0b0hTVihyLCBnLCBiKTtcbiAgICBoc3YudiA9IDAuODtcbiAgICBsZXQgcmdiID0gSFNWdG9SR0IoaHN2KTtcblxuICAgIGRhdGFbaV0gPSByZ2IucjtcbiAgICBkYXRhW2krMV0gPSByZ2IuZztcbiAgICBkYXRhW2krMl0gPSByZ2IuYjtcbiAgICBkYXRhW2krM10gPSAyNTU7XG4gIH1cbn1cblxuLy8gaHN2IGZ1bmN0aW9ucyBmcm9tXG4vLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE3MjQyMTQ0L2phdmFzY3JpcHQtY29udmVydC1oc2ItaHN2LWNvbG9yLXRvLXJnYi1hY2N1cmF0ZWx5XG5mdW5jdGlvbiBIU1Z0b1JHQihoLCBzLCB2KSB7XG4gICAgdmFyIHIsIGcsIGIsIGksIGYsIHAsIHEsIHQ7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgcyA9IGgucywgdiA9IGgudiwgaCA9IGguaDtcbiAgICB9XG4gICAgaSA9IE1hdGguZmxvb3IoaCAqIDYpO1xuICAgIGYgPSBoICogNiAtIGk7XG4gICAgcCA9IHYgKiAoMSAtIHMpO1xuICAgIHEgPSB2ICogKDEgLSBmICogcyk7XG4gICAgdCA9IHYgKiAoMSAtICgxIC0gZikgKiBzKTtcbiAgICBzd2l0Y2ggKGkgJSA2KSB7XG4gICAgICAgIGNhc2UgMDogciA9IHYsIGcgPSB0LCBiID0gcDsgYnJlYWs7XG4gICAgICAgIGNhc2UgMTogciA9IHEsIGcgPSB2LCBiID0gcDsgYnJlYWs7XG4gICAgICAgIGNhc2UgMjogciA9IHAsIGcgPSB2LCBiID0gdDsgYnJlYWs7XG4gICAgICAgIGNhc2UgMzogciA9IHAsIGcgPSBxLCBiID0gdjsgYnJlYWs7XG4gICAgICAgIGNhc2UgNDogciA9IHQsIGcgPSBwLCBiID0gdjsgYnJlYWs7XG4gICAgICAgIGNhc2UgNTogciA9IHYsIGcgPSBwLCBiID0gcTsgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHI6IE1hdGgucm91bmQociAqIDI1NSksXG4gICAgICAgIGc6IE1hdGgucm91bmQoZyAqIDI1NSksXG4gICAgICAgIGI6IE1hdGgucm91bmQoYiAqIDI1NSlcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBSR0J0b0hTVihyLCBnLCBiKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgZyA9IHIuZywgYiA9IHIuYiwgciA9IHIucjtcbiAgICB9XG4gICAgdmFyIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpLCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKSxcbiAgICAgICAgZCA9IG1heCAtIG1pbixcbiAgICAgICAgaCxcbiAgICAgICAgcyA9IChtYXggPT09IDAgPyAwIDogZCAvIG1heCksXG4gICAgICAgIHYgPSBtYXggLyAyNTU7XG5cbiAgICBzd2l0Y2ggKG1heCkge1xuICAgICAgICBjYXNlIG1pbjogaCA9IDA7IGJyZWFrO1xuICAgICAgICBjYXNlIHI6IGggPSAoZyAtIGIpICsgZCAqIChnIDwgYiA/IDY6IDApOyBoIC89IDYgKiBkOyBicmVhaztcbiAgICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSArIGQgKiAyOyBoIC89IDYgKiBkOyBicmVhaztcbiAgICAgICAgY2FzZSBiOiBoID0gKHIgLSBnKSArIGQgKiA0OyBoIC89IDYgKiBkOyBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBoOiBoLFxuICAgICAgICBzOiBzLFxuICAgICAgICB2OiB2XG4gICAgfTtcbn1cbiJdfQ==
